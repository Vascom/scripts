#!/bin/bash

if [ -z "$1" -o -z "$2" ]
then
    echo "Format isn't correct!"
    echo "Use koji_run project_name commit_number dist_number"
    echo "Use koji_run regen number for repos regen"
    exit
fi

koji_config="/etc/koji-rf.conf"

if [ "$1" = "regen" ]
then
    dist_short="$2"
else
    dist_short="$3"
fi

case $dist_short in
    [67])       dist="dist-el$dist_short";;
    rawhide)    dist="dist-rfr-rawhide";;
    21)         dist="dist-rfr$dist_short-devel";;
    *)          dist="dist-rfr$dist_short";;
esac

if [ "$4" = "test" ] || [ "$5" = "test" ]
then
    test="--scratch"
fi

if [ "$4" = "quiet" ] || [ "$5" = "quiet" ]
then
    quiet="--quiet"
fi

if [ "$1" = "regen" ]
then
    koji -c $koji_config regen-repo $dist-build
    exit 0
fi

if [ -z "$3" ]
then
    echo "Need first dist_number"
else
    koji $quiet -c $koji_config build $test $dist git://github.com/RussianFedora/$1.git?#$2 1>/dev/null &
fi
