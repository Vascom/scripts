#!/bin/bash

if [ -z "$1" -o -z "$2" ]
then
    echo "Format isn't correct!"
    echo "Use koji_run project_name commit_number dist_number"
    echo "Use koji_run regen number for repos regen"
    exit
fi

if [ "$1" = "regen" ]
then
    D_SHORT="$2"
else
    D_SHORT="$3"
fi

#if [ "$3" = "16" ]
#then
#    DIST="dist-rfr-alpha$3"
#el
if [ "$D_SHORT" = "6" ]
then
    DIST="dist-el$D_SHORT"
elif [ "$D_SHORT" = "rawhide" ]
then
    DIST="dist-rfr-rawhide"
elif [ "$D_SHORT" = "18" ]
then
    DIST="dist-rfr$D_SHORT-devel"
else
    DIST="dist-rfr$D_SHORT"
fi

if [ "$4" = "test" ]
then
    TEST="--scratch"
fi

if [ "$1" = "regen" ]
then
    koji -c /etc/koji-rfr.conf regen-repo $DIST-build
    exit 0
fi

if [ -z "$3" ]
then
    echo "Need first DIST_NUMBER"
else
    koji -c /etc/koji-rfr.conf build $TEST $DIST git://github.com/RussianFedora/$1.git?#$2 &>/dev/null &
fi
