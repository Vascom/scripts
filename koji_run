#!/bin/bash

if [ -z "$1" -o -z "$2" ]
then
    echo "Format isn't correct!"
    echo "Use koji_run project_name commit_number dist_number"
    echo "Use koji_run regen number for repos regen"
    exit
fi

if [ "$1" = "regen" ]
then
    dist_short="$2"
else
    dist_short="$3"
fi

#if [ "$3" = "16" ]
#then
#    dist="dist-rfr-alpha$3"
#el
if [ "$dist_short" = "6" ]
then
    dist="dist-el$dist_short"
elif [ "$dist_short" = "rawhide" ]
then
    dist="dist-rfr-rawhide"
elif [ "$dist_short" = "19" ]
then
    dist="dist-rfr$dist_short-devel"
else
    dist="dist-rfr$dist_short"
fi

if [ "$4" = "test" ]
then
    test="--scratch"
fi

if [ "$1" = "regen" ]
then
    koji -c /etc/koji-rfr.conf regen-repo $dist-build
    exit 0
fi

if [ -z "$3" ]
then
    echo "Need first dist_number"
else
    koji -c /etc/koji-rfr.conf build $test $dist git://github.com/RussianFedora/$1.git?#$2 &>/dev/null &
fi
